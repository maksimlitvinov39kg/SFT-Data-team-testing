# SFT Data Team Testing

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–æ–±—É—á–µ–Ω–∏—è —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SFT (Supervised Fine-Tuning) –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

## üîó –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—Ä–æ–µ–∫—Ç—É

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- [assets/](./assets/) - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–æ–µ–∫—Ç–∞
- [data/](./data/) - –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ø–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
  - [data/images/](./data/images/) - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–ø–æ –ø–∞–ø–∫–∞–º)
  - [data/json/](./data/json/) - JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - [annotation.json](./data/annotation.json) - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ç–∫–∏
- [finetune_testing/](./finetune_testing/) - –ù–æ—É—Ç–±—É–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìì –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- [caption_data.py](./caption_data.py) - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [train_qwen_with_lora.py](./train_qwen_with_lora.py) - –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
- [test_pretrain.ipynb](./test_pretrain.ipynb) - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏
- [requirements.txt](./requirements.txt) - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

### üóÇÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
- **[Google Drive —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏](https://drive.google.com/drive/folders/1T_3XJvJv0nvGhF5j2txKP7Nj6hjOk1lE?usp=sharing)** - –ü–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –≤–µ—Å–∞ –º–æ–¥–µ–ª–µ–π
---

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö open source VLM –æ–±—É—á–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö –∏ –ø–ª–æ—Ö–æ –∑–Ω–∞–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ–±—Ä–∞–∑—ã –¥—Ä—É–≥–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
1. –í—ã–±—Ä–∞—Ç—å VLM –∏—Å—Ö–æ–¥—è –∏–∑ –∏–º–µ—é—â–∏—Ö—Å—è —Ä–µ—Å—É—Ä—Å–æ–≤
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ß–µ–±—É—Ä–∞—à–∫–∞) –∏ —Å–æ–±—Ä–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —ç—Ç–∏ —Å—É—â–Ω–æ—Å—Ç–∏
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Å–µ—Ä–∏—é —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –ø–æ –¥–æ–æ–±—É—á–µ–Ω–∏—é –º–æ–¥–µ–ª–∏
5. –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
6. –û—Ñ–æ—Ä–º–∏—Ç—å –∫–æ–¥ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
git clone https://github.com/your-username/SFT-Data-team-testing.git
cd SFT-Data-team-testing

python -m venv .venv
source .venv/bin/activate 

pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ:
```env
# API –∫–ª—é—á –¥–ª—è GigaChat (–¥–ª—è caption –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
GIGACHAT_CREDENTIALS=your_gigachat_api_key_here
GIGACHAT_SCOPE=your_gigachat_scope_here
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
python caption_data.py
```

### 4. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤)
```bash
python train_qwen_with_lora.py \
  --lora_r 32 \
  --lora_alpha 64 \
  --max_length 256 \
  --num_train_epochs 50 \
  --learning_rate 5e-5 \
  --per_device_train_batch_size 1 \
  --gradient_accumulation_steps 4 \
  --fp16 \
  --no_wandb
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –¥–æ–æ–±—É—á–µ–Ω–∏—è
–í –ø–∞–ø–∫–µ [finetune_testing/](./finetune_testing/) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–æ—É—Ç–±—É–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:

- [test_after_finetune_lora_init.ipynb](./finetune_testing/test_after_finetune_lora_init.ipynb)
- [test_after_finetune_lora_v1.ipynb](./finetune_testing/test_after_finetune_lora_v1.ipynb)
- [test_after_finetune_lora_v2.ipynb](./finetune_testing/test_after_finetune_lora_v2.ipynb)
- [test_after_finetune_lora_v3.ipynb](./finetune_testing/test_after_finetune_lora_v3.ipynb)
- [–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤](./finetune_testing/results.MD)
---


## üìö –î–∞—Ç–∞—Å–µ—Ç

### –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ
- **–ê–ª—ë—à–∞ –ü–æ–ø–æ–≤–∏—á** - ~20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ß–µ–±—É—Ä–∞—à–∫–∞** - ~30 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ö—Ä–æ–∫–æ–¥–∏–ª –ì–µ–Ω–∞** - ~ 20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ö–æ–ª–æ–±–æ–∫** - ~20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

*–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ –æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏. –ü–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ [Google Drive](https://drive.google.com/drive/folders/1T_3XJvJv0nvGhF5j2txKP7Nj6hjOk1lE?usp=sharing)*

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
```
data/
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ alyosha/      # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ê–ª—ë—à–∏ –ü–æ–ø–æ–≤–∏—á–∞
‚îÇ   ‚îú‚îÄ‚îÄ cheburashka/  # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ß–µ–±—É—Ä–∞—à–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ gena/         # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—Ä–æ–∫–æ–¥–∏–ª–∞ –ì–µ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ kolobok/      # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ö–æ–ª–æ–±–∫–∞
‚îú‚îÄ‚îÄ json/
‚îÇ   ‚îú‚îÄ‚îÄ base_prompts.json      # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ character_names.json   # –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–∞–ø–æ–∫ –∏ –Ω–∞–∑–≤–∞–Ω–∏–π
‚îî‚îÄ‚îÄ annotation.json            # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ç–∫–∏
```

---

## üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

1. **–î–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**
   ```bash
   mkdir data/images/new_character
   ```

2. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
   –í —Ñ–∞–π–ª–µ [`data/json/character_names.json`](./data/json/character_names.json):
   ```json
   {
     "gena": "–ö—Ä–æ–∫–æ–¥–∏–ª –ì–µ–Ω–∞",
     "new_character": "–ù–æ–≤—ã–π –ü–µ—Ä—Å–æ–Ω–∞–∂"
   }
   ```

3. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏—è**
   ```bash
   python caption_data.py
   ```
   –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- **–†–µ—Å—É—Ä—Å—ã**: 7B –º–æ–¥–µ–ª–∏ Qwen –∏ LLaVA –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ 24 –ì–ë –ø–∞–º—è—Ç–∏ MacBook M4 Pro
- **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Qwen-VL 3B –º–æ–¥–µ–ª—å

### –ü—Ä–æ–±–ª–µ–º—ã –æ–±—É—á–µ–Ω–∏—è
- Loss –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ ~4 (max_length=128) –∏ ~2 (max_length=256)
- –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è
- **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–∑–º–µ—Ç–∫–∏
- GigaChat –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ –∫–µ–ø—à–µ–Ω–µ—Ä
- –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º –æ–ø–∏—Å–∞–Ω–∏–π

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–ª–≥–æ –≤—Ä—É—á–Ω—É—é —Å–∫–∞—á–∏–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ, –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º –∫–∞—á–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å –≥—É–≥–ª–∞
